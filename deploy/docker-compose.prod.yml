# Docker Image Sync - 生产部署配置
# 使用预构建的 ghcr.io 镜像，无需本地构建
#
# 镜像版本由 CI 自动替换 __VERSION__ 占位符
# 如需手动修改版本，替换 image 字段中的 tag 即可

services:
  backend:
    image: ghcr.io/annihilater/pull-and-push-image/backend:__VERSION__
    container_name: image-sync-backend
    restart: unless-stopped
    env_file:
      - ./data/.env
    volumes:
      # 挂载宿主机 Docker socket，使容器内可以执行 docker 命令
      - /var/run/docker.sock:/var/run/docker.sock
      # 挂载 Docker 配置（包含 Harbor 登录凭据等）
      # Linux 默认: /root/.docker
      # macOS 默认: /Users/<用户名>/.docker（在 data/.env 中设置 DOCKER_CONFIG_PATH）
      - ${DOCKER_CONFIG_PATH:-/root/.docker}:/root/.docker:ro
    networks:
      - image-sync

  frontend:
    image: ghcr.io/annihilater/pull-and-push-image/frontend:__VERSION__
    container_name: image-sync-frontend
    restart: unless-stopped
    ports:
      - "${FRONTEND_PORT:-8080}:80"
    depends_on:
      - backend
    networks:
      - image-sync

networks:
  image-sync:
    driver: bridge
